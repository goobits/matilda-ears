# Goobits configuration for STT (Speech to Text)
# This file replaces the old setup-config.yaml and defines everything needed for the build command

# Setup fields for setup.sh
package_name: "goobits-stt"
command_name: "stt"
display_name: "STT - Speech to Text"
description: "Real-time speech-to-text transcription powered by Whisper"

# CLI generation configuration
cli_output_path: "src/stt/cli.py"
hooks_path: "src/stt/app_hooks.py"

python:
  minimum_version: "3.8"
  maximum_version: "3.13"

dependencies:
  required:
    - git
    - pipx
  optional:
    - ffmpeg  # For audio processing
    - portaudio  # For microphone input (system package)
  development:
    - ruff    # Modern Python linter and formatter
    - mypy    # Static type checker
    - black   # Code formatter
    - pytest  # Testing framework

installation:
  pypi_name: "goobits-stt"
  development_path: "."
  extras:
    python: ["audio"]
    apt: ["portaudio19-dev", "ffmpeg", "swig", "build-essential", "python3-dev"]

shell_integration:
  enabled: false
  alias: "stt"

validation:
  check_api_keys: false
  check_disk_space: true
  minimum_disk_space_mb: 500

messages:
  install_success: |
    STT has been installed successfully!
    You can now use 'stt' from your terminal.

    Quick start:
      stt listen              # Record and transcribe once
      stt live                # Interactive conversation mode
      stt serve               # Start WebSocket server

  install_dev_success: |
    STT has been installed in development mode!
    âœ… Your local changes will be reflected immediately - no reinstalling needed!

    Development workflow:
      - Edit code in src/stt/ directory
      - Test immediately with: stt listen
      - Run tests with: ./test.py
      - Format code with: ruff format src/stt/
      - Check types with: mypy src/stt/

    ğŸ’¡ No need to run ./setup.sh upgrade after code changes!

  upgrade_success: |
    STT has been upgraded successfully!
    Check out the latest features with: stt --version

  uninstall_success: |
    STT has been uninstalled.
    Thank you for using STT!

# CLI fields for cli.py generation
cli:
  name: "GOOBITS STT CLI"
  version: "1.0.2"
  display_version: true
  tagline: "Real-time speech-to-text with AI-powered Whisper models"
  description: "Convert speech into accurate text with multiple operation modes and advanced formatting."
  icon: "ğŸ¤"
  enable_recursive_help: true
  enable_help_json: true

  header_sections:
    - title: "ğŸ¯ Most Common Use Cases"
      items:
        - { item: 'stt listen', desc: "Quick voice note: Record and transcribe once", style: "example" }
        - { item: 'stt transcribe audio.wav --json', desc: "File transcription: Process audio files with JSON output", style: "example" }
        - { item: 'stt live', desc: "Always listening: Hands-free conversation mode", style: "example" }
        - { item: 'stt live --tap-to-talk=F8', desc: "Press F8 to talk: Controlled conversation mode", style: "example" }
        - { item: 'stt listen --hold-to-talk=space', desc: "Hold spacebar: Push-to-talk recording", style: "example" }
        - { item: 'stt serve --port=8080', desc: "Remote transcription: WebSocket server for clients", style: "example" }

    - title: "ğŸš€ Quick Start (First Time)"
      items:
        - { item: "1. Check system", desc: "stt status", style: "setup" }
        - { item: "2. Test recording", desc: "stt listen", style: "setup" }
        - { item: "3. Try conversation", desc: "stt live", style: "setup" }

    - title: "ğŸ’­ Popular Workflows"
      items:
        - { item: "Voice Notes", desc: "stt listen > notes.txt  # Save transcription to file", style: "example" }
        - { item: "Batch Processing", desc: "stt transcribe *.wav --json  # Process multiple audio files", style: "example" }
        - { item: "Meeting Notes", desc: "stt live --json > meeting.json  # Structured output", style: "example" }
        - { item: "Remote Dictation", desc: "stt serve  # Server + client apps on other devices", style: "example" }
        - { item: "Gaming/Streaming", desc: "stt live --tap-to-talk=F8  # Hotkey control", style: "example" }

    - title: "ğŸ’¡ Core Commands"
      items:
        - { item: "listen", desc: "ğŸ™ï¸  Record once and transcribe (default command)", style: "command" }
        - { item: "live", desc: "ğŸ—£ï¸  Real-time conversation mode with VAD", style: "command" }
        - { item: "transcribe", desc: "ğŸ¯ Transcribe audio files to text", style: "command" }
        - { item: "serve", desc: "ğŸŒ Launch WebSocket transcription server", style: "command" }

  footer_note: "ğŸ“š For detailed help on a command, run: [color(2)]stt [COMMAND][/color(2)] [#ff79c6]--help[/#ff79c6]"

  command_groups:
    - name: "Recording Modes"
      commands: ["listen", "live"]
    - name: "File Processing"
      commands: ["transcribe"]
    - name: "Server & Processing"
      commands: ["serve", "server"]
    - name: "System"
      commands: ["status", "model"]
    - name: "Configuration"
      commands: ["config"]
  
  commands:
    listen:
      desc: "ğŸ™ï¸ Record once and transcribe"
      icon: "ğŸ™ï¸"
      options:
        - name: "model"
          short: "m"
          type: "str"
          desc: "ğŸ§  Whisper model size (tiny=fastest, large=most accurate)"
          choices: ["tiny", "base", "small", "medium", "large"]
          default: "base"
        - name: "language"
          short: "l"
          type: "str"
          desc: "ğŸŒ Language code for transcription (e.g., en, es, fr, auto-detect)"
        - name: "device"
          short: "d"
          type: "str"
          desc: "ğŸ¤ Audio input device (microphone name or index)"
        - name: "hold-to-talk"
          type: "str"
          desc: "âŒ¨ï¸  Hold-to-talk key (e.g., space, F8, ctrl)"
        - name: "no-formatting"
          type: "bool"
          desc: "ğŸ“ Output unformatted raw text"
          default: false
        - name: "sample-rate"
          type: "int"
          desc: "ğŸ”Š Audio sampling rate (Hz)"
          default: 16000
        - name: "json"
          type: "flag"
          desc: "ğŸ“‹ Output transcription results as JSON"
        - name: "debug"
          type: "flag"
          desc: "ğŸ Enable detailed debug logging"
        - name: "config"
          type: "str"
          desc: "âš™ï¸ Path to custom config file"

    live:
      desc: "ğŸ—£ï¸ Real-time interactive transcription"
      icon: "ğŸ—£ï¸"
      options:
        - name: "model"
          short: "m"
          type: "str"
          desc: "ğŸ§  Whisper model size (tiny=fastest, large=most accurate)"
          choices: ["tiny", "base", "small", "medium", "large"]
          default: "base"
        - name: "language"
          short: "l"
          type: "str"
          desc: "ğŸŒ Language code for transcription (e.g., en, es, fr, auto-detect)"
        - name: "device"
          short: "d"
          type: "str"
          desc: "ğŸ¤ Audio input device (microphone name or index)"
        - name: "tap-to-talk"
          type: "str"
          desc: "ğŸ‘† Tap-to-talk key (e.g., F8)"
        - name: "no-formatting"
          type: "bool"
          desc: "ğŸ“ Output unformatted raw text"
          default: false
        - name: "sample-rate"
          type: "int"
          desc: "ğŸ”Š Audio sampling rate (Hz)"
          default: 16000
        - name: "json"
          type: "flag"
          desc: "ğŸ“‹ Output transcription results as JSON"
        - name: "debug"
          type: "flag"
          desc: "ğŸ Enable detailed debug logging"
        - name: "config"
          type: "str"
          desc: "âš™ï¸ Path to custom config file"

    serve:
      desc: "ğŸŒ Launch transcription server"
      icon: "ğŸŒ"
      options:
        - name: "port"
          short: "p"
          type: "int"
          desc: "ğŸŒ Server port (default 8769)"
          default: 8769
        - name: "host"
          short: "h"
          type: "str"
          desc: "ğŸ  Server host address (default 0.0.0.0)"
          default: "0.0.0.0"
        - name: "debug"
          type: "flag"
          desc: "ğŸ Enable detailed debug logging"
        - name: "config"
          type: "str"
          desc: "âš™ï¸ Path to custom config file"

    transcribe:
      desc: "ğŸ¯ Transcribe audio files to text"
      icon: "ğŸ¯"
      args:
        - name: "audio_files"
          desc: "ğŸµ Audio file(s) to transcribe (WAV, MP3, Opus supported)"
          nargs: "+"
          required: true
      options:
        - name: "model"
          short: "m"
          type: "str"
          desc: "ğŸ§  Whisper model size (tiny=fastest, large=most accurate)"
          choices: ["tiny", "base", "small", "medium", "large"]
          default: "base"
        - name: "language"
          short: "l"
          type: "str"
          desc: "ğŸŒ Language code for transcription (e.g., en, es, fr, auto-detect)"
        - name: "json"
          type: "flag"
          desc: "ğŸ“‹ Output transcription results as JSON"
        - name: "prefer-server"
          type: "flag"
          desc: "ğŸŒ Try WebSocket server first, fallback to direct"
        - name: "server-only"
          type: "flag"
          desc: "ğŸ”’ Require WebSocket server connection"
        - name: "direct-only"
          type: "flag"
          desc: "ğŸ–¥ï¸ Skip server, use direct Whisper processing"
        - name: "output"
          short: "o"
          type: "str"
          desc: "ğŸ“„ Output format (plain, json, matilda)"
          choices: ["plain", "json", "matilda"]
          default: "plain"
        - name: "debug"
          type: "flag"
          desc: "ğŸ Enable detailed debug logging"
        - name: "config"
          type: "str"
          desc: "âš™ï¸ Path to custom config file"

    status:
      desc: "âœ… Check system health and device status"
      icon: "âœ…"
      options:
        - name: "json"
          type: "flag"
          desc: "ğŸ“‹ Output status results as JSON"

    model:
      desc: "Manage Whisper models"
      icon: "ğŸ§ "
      subcommands:
        download:
          desc: "Download a Whisper model"
          args:
            - name: "model_name"
              desc: "ğŸ”½ Model name to download (tiny, base, small, medium, large)"
              required: true
              choices: ["tiny", "base", "small", "medium", "large"]
          options:
            - name: "force"
              short: "f"
              type: "flag"
              desc: "ğŸ”„ Force re-download even if model exists"
            - name: "device"
              short: "d"
              type: "str"
              desc: "ğŸ’» Device type for model optimization (cpu, cuda, auto)"
              choices: ["cpu", "cuda", "auto"]
              default: "auto"
        list:
          desc: "List available and downloaded models"
          options:
            - name: "downloaded-only"
              type: "flag"
              desc: "ğŸ“¦ Show only downloaded models"
            - name: "json"
              type: "flag"
              desc: "ğŸ“‹ Output as JSON"
        info:
          desc: "Show detailed model information"
          args:
            - name: "model_name"
              desc: "ğŸ” Model name to inspect"
              required: true
              choices: ["tiny", "base", "small", "medium", "large"]
          options:
            - name: "json"
              type: "flag"
              desc: "ğŸ“‹ Output as JSON"
        remove:
          desc: "Remove downloaded model"
          args:
            - name: "model_name"
              desc: "ğŸ—‘ï¸ Model name to remove"
              required: true
              choices: ["tiny", "base", "small", "medium", "large"]
          options:
            - name: "force"
              short: "f"
              type: "flag"
              desc: "ğŸ”„ Skip confirmation prompt"
        benchmark:
          desc: "Test model performance"
          args:
            - name: "model_name"
              desc: "âš¡ Model name to benchmark"
              required: true
              choices: ["tiny", "base", "small", "medium", "large"]
          options:
            - name: "duration"
              short: "t"
              type: "int"
              desc: "â±ï¸ Test duration in seconds"
              default: 10
            - name: "device"
              short: "d"
              type: "str"
              desc: "ğŸ’» Device to test on (cpu, cuda, auto)"
              choices: ["cpu", "cuda", "auto"]
              default: "auto"
            - name: "json"
              type: "flag"
              desc: "ğŸ“‹ Output results as JSON"

    config:
      desc: "âš™ï¸ Adjust CLI settings and preferences"
      icon: "âš™ï¸"
      subcommands:
        show:
          desc: "ğŸ‘ï¸ Display current configuration"
          options:
            - name: "json"
              type: "flag"
              desc: "ğŸ“‹ Output configuration as JSON"
        get:
          desc: "ğŸ” Retrieve configuration value"
          args:
            - name: "key"
              desc: "ğŸ”‘ Configuration key"
              required: true
        set:
          desc: "âœï¸ Set a configuration value"
          args:
            - name: "key"
              desc: "ğŸ”‘ Configuration key"
              required: true
            - name: "value"
              desc: "ğŸ’¾ Configuration value"
              required: true

    server:
      desc: "Basic server management"
      icon: "ğŸ”§"
      subcommands:
        status:
          desc: "Check if server is running"
          options:
            - name: "port"
              short: "p"
              type: "int"
              desc: "ğŸŒ Server port to check"
              default: 8769
            - name: "json"
              type: "flag"
              desc: "ğŸ“‹ Output status as JSON"
        start:
          desc: "Start server (simple mode)"
          options:
            - name: "port"
              short: "p"
              type: "int"
              desc: "ğŸŒ Server port"
              default: 8769
            - name: "host"
              short: "h"
              type: "str"
              desc: "ğŸ  Server host address"
              default: "0.0.0.0"
            - name: "json"
              type: "flag"
              desc: "ğŸ“‹ Output result as JSON"

  config:
    rich_help_panel: true
    show_metavars_column: false
    append_metavars_help: true
    style_errors_suggestion: true
    max_width: 120